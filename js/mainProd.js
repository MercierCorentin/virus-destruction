$(function(){"use strict";function t(){var a=e();u>1500?u-=100:u<=1500&&u>1200&&(u-=50),h>=15&&5==++M&&(h--,M=0),clearInterval(x),x=setInterval(function(){t()},u);var n=setInterval(function(){s(a,n)},h)}function e(){d=Math.round(Math.random()*(l-34)+17),$("#death-message").after("<img class='virus' id='virus_"+p+"' src='img/virus.png'>"),$("#virus_"+p).css("left",d);var t=$("#virus_"+p);return y.push(t),p++,t}function s(t,e){if(t.css("top","+=2"),t.position().top>i-o){clearInterval(e);var s=y.indexOf(t);y.splice(s,1),t.remove(),(v-=5)<=0&&(clearInterval(x),$("#death-message").css("display","block")),$("#green").css("width",v+"%")}}function a(t){if(g<4){if(g++,m++,!(t<Math.PI&&t>0))return g--,!1;$("#death-message").after("<img class='bullet' id='bullet_"+m+"'' src='img/bullet.png'>");var e=Math.round(45*Math.cos(t))+l/2,s=i-Math.round(45*Math.sin(t)),a=$("#bullet_"+m).offset();return a.top=s,a.left=e,$("#bullet_"+m).offset(a),$("#bullet_"+m)}return!1}function n(t,e,s,a){e<=45?(a.css("left","+=4"),a.css("top",i-Math.tan(s)*(a.offset().left-l/2))):e>45&&e<=90?(a.css("top","-=4"),a.css("left",l/2+(i-a.offset().top)/Math.tan(s))):e>90&&e<=135?(a.css("top","-=4"),a.css("left",l/2-(i-a.offset().top)/Math.tan(Math.PI-s))):e>135&&(a.css("left","-=4"),a.css("top",i-Math.tan(Math.PI-s)*(l/2-a.offset().left)));for(var n=0;n<=y.length-1;n++)r(a,y[n],t);(a.offset().top<=8||a.offset().top>=i||a.offset().left>l-8||a.offset().left<8)&&(a.remove(),g--,clearInterval(t))}function r(t,e,s){var a=t.offset().top,n=t.offset().left,r=e.offset().top,l=e.offset().left;if(n<l+o-1&&n>l-(c-1)&&a>r-(f-1)&&a<r+o-1)return e.remove(),t.remove(),I++,y.splice(y.indexOf(e),1),$("#current-score-player").text(": "+I),clearInterval(w),void clearInterval(s)}var o=32,f=8,c=8,l=window.outerWidth-10,i=window.outerHeight-20,u=3e3,h=40,v=100,d=0,g=0,p=0,m=0,M=0,I=0,b=0,_=0,w=0,P=0,y=[];$("body, #game-container, html").css("width",l).css("height",i),$("#life-bar").css("left",l-80),b=l/2-$("#death-message").outerWidth()/2,$("#death-message").css("left",b),_=i/2-$("#death-message").outerHeight()/2,$("#death-message").css("top",_),P=l/2-$("#canon").outerWidth()/2,$("#canon").css("left",P),document.getElementById("game-container").addEventListener("click",function(t){var e=l/2-t.pageX,s=i-t.pageY,r=Math.atan(s/Math.abs(e)),o=180*r/Math.PI,f=10*Math.round(o/10);e>0&&(o=180-o,f=180-f,r=Math.PI-r),$("#canon").attr("src","img/canon/"+f+".png");var c=a(r);if(0!=c)var u=setInterval(function(){n(u,o,r,c)},20)});var x=setInterval(function(){t()},u)});